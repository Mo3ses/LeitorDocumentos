<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Renomeador 2000 Professional Edition</title>
    <style>
        body {
            background-color: #008080; /* Azul petr√≥leo cl√°ssico do Windows 95/98 */
            font-family: 'Verdana', sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        /* Janela Estilo Windows 98 */
        .window {
            background-color: #c0c0c0;
            border: 2px solid;
            border-color: #ffffff #808080 #808080 #ffffff;
            box-shadow: 4px 4px 10px rgba(0,0,0,0.5);
            width: 100%;
            max-width: 800px;
            padding: 2px;
        }

        .title-bar {
            background: linear-gradient(90deg, #000080, #1084d0);
            padding: 4px 8px;
            color: white;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .title-bar-text {
            font-size: 14px;
            letter-spacing: 1px;
        }

        .window-body {
            padding: 15px;
        }

        /* Marquee (Texto correndo) */
        .marquee-container {
            background: black;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            border: 2px inset white;
            margin-bottom: 20px;
            padding: 5px;
        }

        /* Bot√µes Retro 3D */
        .retro-btn {
            background: #c0c0c0;
            border: 2px solid;
            border-color: #ffffff #808080 #808080 #ffffff;
            padding: 8px 15px;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            font-family: 'Tahoma', sans-serif;
            font-size: 12px;
        }

            .retro-btn:active {
                border-color: #808080 #ffffff #ffffff #808080;
                transform: translateY(1px);
            }

            .retro-btn:hover {
                background: #dcdcdc;
            }

        /* √Årea de Drop */
        .drop-zone {
            background: white;
            border: 2px inset #808080;
            padding: 30px;
            text-align: center;
            margin-bottom: 15px;
            cursor: pointer;
        }

            .drop-zone:hover {
                background: #ffffcc;
            }

        /* Tabela Retro */
        table {
            width: 100%;
            border-collapse: collapse;
            border: 2px solid gray;
            background: white;
            font-size: 12px;
        }

        th {
            background: #c0c0c0;
            border: 1px solid gray;
            padding: 5px;
            text-align: left;
        }

        td {
            border: 1px solid gray;
            padding: 5px;
            font-family: 'Courier New', monospace;
        }

        /* Status */
        .status-ok {
            color: #008000;
            font-weight: bold;
        }

        .status-err {
            color: #ff0000;
            font-weight: bold;
            text-decoration: blink;
        }

        /* Overlay Retro */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 9999;
        }

        .loading-box {
            background: #c0c0c0;
            border: 2px outset white;
            padding: 20px;
            text-align: center;
            width: 300px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: white;
            border: 2px inset gray;
            margin-top: 10px;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: #000080;
            width: 0%;
            animation: load 2s infinite;
        }

        @keyframes load {
            0% {
                width: 0%;
            }

            100% {
                width: 100%;
            }
        }

        /* Imagem Social Credit */
        .meme-img {
            max-width: 400px;
            border: 5px ridge gold;
            margin-bottom: 15px;
        }

        /* Sele√ß√£o de Tipo (Radio Buttons) */
        .radio-group {
            background: #d4d0c8;
            border: 2px groove white;
            padding: 10px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>

    <div class="overlay" id="loadingOverlay">
        <div class="loading-box">
            <p>Processando Arquivos.exe...</p>
            <div class="progress-bar"><div class="progress-fill"></div></div>
            <p style="font-size: 10px; margin-top: 5px;">Por favor aguarde...</p>
        </div>
    </div>

    <div class="overlay" id="successOverlay">
        <div style="text-align: center;">
            <img src="image_0.png" class="meme-img" alt="Social Credit">
            <br>
            <button class="retro-btn" style="font-size: 16px; padding: 10px 30px;" onclick="closeOverlay()">OK</button>
        </div>
    </div>

    <div class="window">
        <div class="title-bar">
            <span class="title-bar-text">Renomeador Pro v4.0 - Build 2025</span>
            <div style="background: #c0c0c0; color: black; padding: 0 4px; font-weight: bold; border: 1px outset white;">X</div>
        </div>

        <div class="window-body">

            <div class="marquee-container">
                <marquee scrollamount="5" scrolldelay="100">
                    *** BEM-VINDO AO SISTEMA *** RENOMEIE SEUS ARQUIVOS COM SEGURAN√áA *** N√ÉO DESLIGUE O COMPUTADOR ***
                </marquee>
            </div>

            <form id="uploadForm">
                <fieldset class="radio-group">
                    <legend>Tipo de Documento</legend>
                    <label style="margin-right: 15px; cursor: pointer;">
                        <input type="radio" name="tipoDoc" value="holerite" checked> üìÅ Holerite
                    </label>
                    <label style="margin-right: 15px; cursor: pointer;">
                        <input type="radio" name="tipoDoc" value="comprovante"> üè¶ Comprovante
                    </label>
                    <label style="cursor: pointer;">
                        <input type="radio" name="tipoDoc" value="recibo"> üèñÔ∏è Recibo F√©rias
                    </label>
                </fieldset>

                <div class="drop-zone" onclick="document.getElementById('fileInput').click()">
                    <img src="https://win98icons.alexmeub.com/icons/png/directory_open_file_mydocs-4.png" width="32">
                    <p><b>Clique aqui</b> para selecionar os arquivos PDF</p>
                    <p id="fileStatus" style="color: blue;">Nenhum arquivo selecionado</p>
                    <input type="file" id="fileInput" multiple accept=".pdf" style="display: none" onchange="updateCount()">
                </div>

                <div style="text-align: right;">
                    <button type="submit" class="retro-btn">üíæ INICIAR PROCESSAMENTO</button>
                </div>
            </form>

            <hr style="border: 1px inset white; margin: 15px 0;">

            <div class="result-area" id="resultArea" style="display:none;">
                <p><b>Relat√≥rio de Sa√≠da:</b></p>
                <table>
                    <thead>
                        <tr>
                            <th>Arquivo Original</th>
                            <th>Novo Nome</th>
                            <th>Status</th>
                            <th>Debug</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>

        <div style="padding: 5px; font-size: 10px; color: #555; border-top: 1px solid #808080;">
            Desenvolvido em C# .NET 10 | Microsoft Corp. (c) 1995-2025
        </div>
    </div>

    <script>
        function updateCount() {
            const count = document.getElementById('fileInput').files.length;
            document.getElementById('fileStatus').innerText = count > 0 ? `${count} arquivos na fila` : "Nenhum arquivo selecionado";
        }

        function closeOverlay() {
            document.getElementById('successOverlay').style.display = 'none';
        }

        function showDebug(text) {
            // Abre uma janelinha pop-up com o texto cru
            const win = window.open("", "Debug", "width=600,height=400");
            win.document.write("<pre style='white-space: pre-wrap; font-family: monospace;'>" + text + "</pre>");
        }

        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const files = document.getElementById('fileInput').files;
            if (files.length === 0) return alert("ERRO: Insira o disco na unidade (Selecione arquivos).");

            const tipoDoc = document.querySelector('input[name="tipoDoc"]:checked').value;
            const loading = document.getElementById('loadingOverlay');
            const success = document.getElementById('successOverlay');
            const resultArea = document.getElementById('resultArea');
            const tableBody = document.getElementById('tableBody');

            loading.style.display = "flex";
            resultArea.style.display = "none";
            tableBody.innerHTML = "";

            const formData = new FormData();
            formData.append('tipoDoc', tipoDoc);
            for (let i = 0; i < files.length; i++) formData.append('files', files[i]);

            try {
                const response = await fetch('/upload', { method: 'POST', body: formData });
                if (!response.ok) throw new Error("Falha na comunica√ß√£o com o servidor.");
                const data = await response.json();

                loading.style.display = "none";
                success.style.display = "flex";

                // Preenche a tabela
                data.lista.forEach(item => {
                    const tr = document.createElement('tr');
                    const classeStatus = item.status.includes("Falha") ? "status-err" : "status-ok";

                    // Escapa as aspas para n√£o quebrar o HTML do bot√£o
                    const safeDebug = item.debug.replace(/"/g, "&quot;").replace(/'/g, "&#39;");

                    tr.innerHTML = `
                            <td>${item.original}</td>
                            <td>${item.novo}</td>
                            <td class="${classeStatus}">${item.status}</td>
                            <td style="text-align:center;">
                                <button class="retro-btn" style="font-size:10px;" onclick='showDebug(${JSON.stringify(item.debug)})'>üîç VER</button>
                            </td>
                        `;
                    tableBody.appendChild(tr);
                });

                resultArea.style.display = "block";

                // Download autom√°tico ap√≥s fechar o overlay ou ap√≥s delay
                setTimeout(() => {
                    downloadBase64File(data.arquivoZip, `arquivos_${tipoDoc}_processados.zip`);
                }, 2000);

            } catch (err) {
                loading.style.display = "none";
                alert("Erro Fatal: " + err.message);
            }
        });

        function downloadBase64File(base64Data, fileName) {
            const linkSource = `data:application/zip;base64,${base64Data}`;
            const link = document.createElement("a");
            link.href = linkSource;
            link.download = fileName;
            link.click();
        }
    </script>
</body>
</html>